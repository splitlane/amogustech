(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6655:(e,n,r)=>{Promise.resolve().then(r.bind(r,6240))},6240:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>v});var t=r(4650),a=r(975);let s={},c=["c","d","h","s"],i=(e,n)=>{s[n+e]="/cards/".concat(n+e,".svg")},l=e=>{c.forEach(n=>{i(n,e)})};for(let e=1;e<=10;e++)l(e);for(let e of["j","q","k"])l(e);i("","b");let o=[];for(let[e,n]of Object.entries(s))o.push(e);let d={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,j:11,q:12,k:13};function u(e,n){let r=d[n],t=d[e];return t-r==1||t-r==-12}function h(e,n){let r=d[n],t=d[e];return t-r==-1||t-r==12}var x=r(4854),p=r(3064),g=r(6194);function m(e){return"amogusclubslapjackonline"+e}function j(e){return e.substring(24)}function f(e){let{card:n,style:r={}}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("img",{style:{border:"1px solid black",borderRadius:"10px",...r},src:s[n]})})}var y=r(6258);function v(){let[e,n]=(0,p.useState)(!1);(0,p.useEffect)(()=>{e||(o.map(e=>{x.preload(s[e],{as:"image"})}),n(!0))},[e]);let[r,c]=(0,p.useState)("join"),[i,l]=(0,p.useState)(""),[d,v]=(0,p.useState)("");(0,p.useEffect)(()=>{if(""==i){var e;b(null!==(e=localStorage.getItem("username"))&&void 0!==e?e:"")}},[i]),(0,p.useEffect)(()=>{if(""==d){var e;w(null!==(e=localStorage.getItem("id"))&&void 0!==e?e:"")}},[d]);let b=e=>{localStorage.setItem("username",e),l(e)},w=e=>{localStorage.setItem("id",e),v(e)},[k,C]=(0,p.useState)("join"),[S,E]=(0,p.useState)(""),[z,q]=function(e,n){let[r,t]=(0,p.useState)(""),[a,s]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{if(!a){let n=new URL(window.location.href).searchParams.get(e);null!=n&&t(n),s(!0)}},[t,e,a]),[r,t]}("code",0),[D,N]=(0,p.useState)(!1),[A,I]=(0,p.useState)(null),R=e=>{I(e),D&&navigator.clipboard.writeText(JSON.stringify(e))},U=(0,p.useRef)(null),V=(0,p.useRef)(null),O=(0,p.useRef)([]),[M,X]=(0,p.useState)(!1),T=A?A.players.find(e=>e.id==U.current.id):null,G=A?A.players.findIndex(e=>e.id==U.current.id):null;function J(e){return"".concat(i,": ").concat(e)}function L(e){R({...A,chat:[...A.chat,e]})}function P(e){L(e),O.current.forEach(n=>{n.send({action:"newMessage",message:e})})}function Z(){if(0==Object.entries(ei).reduce((e,n)=>{let[r,t]=n;return e+t},0)){var e;e=J(S),"join"==k?V.current.send({action:"newMessage",message:e}):"create"==k&&P(e)}else Object.entries(ei).reduce((e,n)=>{let[r,t]=n;return e+t},0)>=T.cards.length?alert("Not enough cards. Needs at least 1 card left."):("join"==k?V.current.send({action:"sendCharity",charity:ei,id:T.id}):"create"==k&&ed(ei,T.id),ec({}),el({}))}let _=(0,p.useRef)(null);function F(e){let n=(A.turn+1)%A.players.length;for(;0==A.players[n].cards.length;)n=(n+1)%A.players.length;R({...A,stack:[...A.stack,e],turn:n,players:A.players.map((e,n)=>n==A.turn?{...e,cards:e.cards.slice(0,-1)}:e)}),_.current=!0}function Y(e){F(e),O.current.forEach(n=>{n.send({action:"placeCard",card:e})})}function Q(){let e=T.cards[T.cards.length-1];"join"==k?V.current.send({action:"placeCard",card:e}):"create"==k&&Y(e)}function H(e,n){let r=A.players[e].cards;if(0==r.length)R({chat:[...A.chat,"".concat(A.players[e].username," burned nothing (").concat(Math.round(n),"ms)")]});else{let t=r[r.length-1];R({...A,stack:[t,...A.stack],players:A.players.map((n,r)=>r==e?{...n,cards:n.cards.slice(0,-1)}:n),chat:[...A.chat,"".concat(A.players[e].username," burned (").concat(Math.round(n),"ms)")]})}}function B(e,n){H(e,n),O.current.forEach(r=>{r.send({action:"burnCard",playerI:e,ms:n})})}function W(e){"join"==k?V.current.send({action:"burnCard",playerI:G,ms:e}):"create"==k&&B(G,e)}!0===_.current&&(_.current=performance.now());let K=(0,p.useRef)(!1);function $(e){let{playerI:n,slap:r,ms:t}=e[0];K.current=!1,R({...A,stack:[],players:A.players.map((e,r)=>r==n?{...e,cards:[...A.stack.toReversed(),...e.cards]}:e),turn:n})}function ee(e,n,r){K.current=!0,R({...A,chat:[...A.chat,"".concat(A.players[e].username," got ").concat(n," (").concat(Math.round(r),"ms)")]})}let en=(0,p.useRef)([]),er=(0,p.useRef)(null);function et(e,n,r){ee(e,n,r),O.current.forEach(t=>{t.send({action:"slapCard",playerI:e,slap:n,ms:r})}),en.current.push({playerI:e,slap:n,ms:r}),1==en.current.length&&setTimeout(()=>{er.current()},3e3)}function ea(e,n){"join"==k?V.current.send({action:"slapCard",playerI:G,slap:e,ms:n}):"create"==k&&et(G,e,n)}er.current=()=>{0!=en.current.length&&(en.current.sort((e,n)=>e.ms-n.ms),$(en.current),O.current.forEach(e=>{e.send({action:"slapCardEnd",slaps:en.current})}),en.current=[])};let[es,ec]=(0,p.useState)({}),[ei,el]=(0,p.useState)({});function eo(e,n){let r="",t=A.players.find(e=>e.id==n),a=t.username,s=0,c={};Object.entries(e).forEach(e=>{let[n,i]=e;0!=i&&(r+="\n".concat(a," donated ").concat(i," to ").concat(A.players.find(e=>e.id==n).username),c[n]=t.cards.slice(t.cards.length-s-i,t.cards.length-s),s+=i)}),R({...A,players:A.players.map(e=>e.id==n?{...e,cards:e.cards.slice(0,-s)}:c[e.id]?{...e,cards:[...e.cards,...c[e.id]]}:e),chat:[...A.chat,""==S?r:J(S)+r]})}function ed(e,n){eo(e,n),O.current.forEach(r=>{r.send({action:"sendCharity",charity:e,id:n})})}let eu=(0,p.useRef)(null);eu.current=e=>{null==A?(R(e),V.current.send({action:"new",id:U.current.id,username:i})):"setGame"==e.action?R(e.game):"newMessage"==e.action?L(e.message):"placeCard"==e.action?F(e.card):"burnCard"==e.action?H(e.playerI,e.ms):"slapCard"==e.action?ee(e.playerI,e.slap,e.ms):"slapCardEnd"==e.action?$(e.slaps):"sendCharity"==e.action&&eo(e.charity,e.id)};let eh=(0,p.useRef)(null);function ex(e){let n=A.turn;return{backgroundColor:n==e?"#94CE9A":null,border:"3px solid "+(n==e?"#2A7E3B":"#00000000")}}eh.current=e=>{if("new"==e.action){let n={...A,players:[...A.players,{id:e.id,username:e.username,cards:[]}]};R(n),O.current.forEach(e=>{e.send({action:"setGame",game:n})})}else"newMessage"==e.action?P(e.message):"placeCard"==e.action?Y(e.card):"burnCard"==e.action?B(e.playerI,e.ms):"slapCard"==e.action?et(e.playerI,e.slap,e.ms):"sendCharity"==e.action&&ed(e.charity,e.id)},(0,p.useEffect)(()=>{let e=e=>{if(e.target==document.body){if(" "==e.key&&e.preventDefault()," "==e.key){if(null!==_.current&&!0!==_.current){let e=performance.now()-_.current;_.current=null;let n=function(e){if(!(e.length>=1))return!1;{let n=e[e.length-1],r=n.substring(0,n.length-1);if("j"==r)return"Jack";if(!(e.length>=2))return!1;{let n=e[e.length-2],t=n.substring(0,n.length-1);if("q"==r&&"k"==t||"q"==t&&"k"==r)return"Marriage";if(r==t)return"Double";if(!(e.length>=3))return!1;{let n=e[e.length-3],a=n.substring(0,n.length-1);return a==r?"Sandwich":u(t,r)&&u(a,t)?"Descending":h(t,r)&&h(a,t)?"Ascending":("q"==r&&"k"==a||"q"==a&&"k"==r)&&"Divorce"}}}}(A.stack);!1===n?W(e):ea(n,e)}}else"p"!=e.key||G!=A.turn||K.current||Q()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[A,W,Q,G,ea]);let ep=(0,p.useRef)(null);return(0,p.useEffect)(()=>{ep.current&&(ep.current.scrollTop=ep.current.scrollHeight)},[null==A?void 0:A.chat]),(0,t.jsx)(a.W2,{children:"join"==r?(0,t.jsx)(a.rj,{children:(0,t.jsx)(a.kC,{direction:"column",height:"100vh",justify:"center",children:(0,t.jsxs)(a.Zb,{size:"4",className:"w-[400px]",children:[(0,t.jsx)(a.X6,{as:"h3",size:"6",trim:"start",children:"Join game"}),(0,t.jsx)(a.xu,{height:"24px"}),(0,t.jsxs)("label",{children:[(0,t.jsx)(a.xv,{as:"div",size:"2",weight:"medium",mb:"1",children:"Username"}),(0,t.jsx)(a.nv.Root,{placeholder:"Username here...",value:i,onChange:e=>b(e.target.value)})]}),(0,t.jsx)(a.xu,{height:"24px"}),(0,t.jsx)(a.xv,{as:"div",size:"2",weight:"medium",mb:"1",children:"Choose option"}),(0,t.jsxs)(a.Jx.f,{value:k,onValueChange:e=>C(e),children:[(0,t.jsx)(a.Jx.c,{value:"join",children:(0,t.jsxs)(a.kC,{direction:"column",width:"100%",children:[(0,t.jsx)(a.xv,{weight:"bold",children:"Join game"}),(0,t.jsx)(a.xv,{children:"Enter the game code to enter."})]})}),(0,t.jsx)(a.Jx.c,{value:"create",children:(0,t.jsxs)(a.kC,{direction:"column",width:"100%",children:[(0,t.jsx)(a.xv,{weight:"bold",children:"Create game"}),(0,t.jsx)(a.xv,{children:"For one person per group."})]})})]}),"join"==k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.xu,{height:"24px"}),(0,t.jsxs)("label",{children:[(0,t.jsx)(a.xv,{as:"div",size:"2",weight:"medium",mb:"1",children:"Game code"}),(0,t.jsx)(a.nv.Root,{placeholder:"Game code here...",value:z,onChange:e=>q(e.target.value)})]})]}):"create"==k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.xu,{height:"24px"}),(0,t.jsxs)("label",{children:[(0,t.jsx)(a.xv,{as:"div",size:"2",weight:"medium",mb:"1",children:"Custom game code (optional)"}),(0,t.jsx)(a.nv.Root,{placeholder:"Game code here...",value:d,onChange:e=>w(e.target.value)})]})]}):null,(0,t.jsx)(a.xu,{height:"32px"}),(0,t.jsx)(a.zx,{disabled:""===i||"join"==k&&""===z||M,onClick:()=>{var e;X(!0),(e=m(""===d?crypto.randomUUID():d),new Promise((n,r)=>{let t={config:{iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:global.relay.metered.ca:80",username:"9159a308d71ff7e6fe0c7aad",credential:"zu0puoDQegDNeXwg"},{urls:"turn:global.relay.metered.ca:80?transport=tcp",username:"9159a308d71ff7e6fe0c7aad",credential:"zu0puoDQegDNeXwg"},{urls:"turn:global.relay.metered.ca:443",username:"9159a308d71ff7e6fe0c7aad",credential:"zu0puoDQegDNeXwg"},{urls:"turns:global.relay.metered.ca:443?transport=tcp",username:"9159a308d71ff7e6fe0c7aad",credential:"zu0puoDQegDNeXwg"}]}},a=e?new g.ZP(e,t):new g.ZP(t);a.on("open",()=>{n(a)}),a.on("error",e=>{console.error(e)})})).then(e=>{if(U.current=e,localStorage.setItem("id",j(e.id)),"join"==k)new Promise((n,r)=>{let t=e.connect(m(z),{reliable:!0});t.on("error",e=>{console.error(e),n(!1)}),t.on("close",()=>{alert("Error: server disconnected")}),t.on("data",e=>{V.current=t,eu.current(e),console.log("dataClient",e),"setGame"==e.action&&n(!0)})}).then(()=>{c("game")});else if("create"==k){let n={code:e.id,players:[{id:e.id,username:i,cards:[]}],turn:-1,chat:[],stack:[],state:"start"};R(n),e.on("connection",e=>{e.on("open",()=>{console.log("open2"),e.send(n),O.current=[...O.current,e]}),e.on("close",()=>{O.current=O.current.filter(n=>n.peer!==e.peer)}),e.on("data",e=>{eh.current(e)})}),c("game")}})},children:"Submit"})]})})}):"game"==r?(0,t.jsxs)(a.kC,{direction:"column",children:[(0,t.jsx)(a.xu,{height:"30px"}),(0,t.jsxs)(a.kC,{align:"center",gap:"3",children:[(0,t.jsx)(a.X6,{className:"flex-grow",children:"Slapjack Online"}),(0,t.jsxs)(a.Vq.fC,{children:[(0,t.jsx)(a.Vq.xz,{children:(0,t.jsxs)(a.zx,{children:[(0,t.jsx)(y.AMp,{}),"Help"]})}),(0,t.jsxs)(a.Vq.VY,{children:[(0,t.jsx)(a.Vq.Dx,{children:"Help"}),(0,t.jsx)(a.Vq.dk,{className:"whitespace-pre-wrap",children:"The objective of this game is to get many cards in your hand. It is turn based, and each person places one card when it is their turn. Once they place, it becomes the next person's turn. When any of the rules below activate, any person can slap. Once a person slaps, they can get all of the cards on the table. The person who slaps starts the next round.\n\nRules (suit does not matter, only number does):\nJack: one jack (j)\nMarriage: queen and king consecutively (qk or kq)\nDouble: two same numbers in a row (aa)\nSandwich: two same numbers with a card in the middle (aba)\nDescending: card numbers are decreasing (ex: 987, 1kq)\nAscending: card numbers are increasing (ex: 789, qk1)\nDivorce: queen and king with a card in the middle (qak or kaq)"})]})]}),(0,t.jsx)(a.xv,{weight:"medium",children:"Press p to place, space to slap"}),(0,t.jsxs)(a.xv,{children:["Code: ",j(A.code)]}),(0,t.jsxs)(a.zx,{onClick:()=>{navigator.clipboard.writeText(window.location.protocol+"//"+window.location.host+window.location.pathname+"?code="+j(A.code))},children:[" ",(0,t.jsx)(y.TIy,{})," Copy link"]}),"create"==k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.xu,{}),(0,t.jsx)(a.xv,{children:"Server controls"}),(0,t.jsxs)(a.Vq.fC,{children:[(0,t.jsx)(a.Vq.xz,{children:(0,t.jsxs)(a.zx,{children:[(0,t.jsx)(y.UG6,{}),"Settings"]})}),(0,t.jsxs)(a.Vq.VY,{children:[(0,t.jsx)(a.Vq.Dx,{children:"Settings"}),(0,t.jsxs)(a.kC,{direction:"column",gap:"3",children:[(0,t.jsx)(a.zx,{onClick:async()=>{await navigator.clipboard.writeText(JSON.stringify(A))},children:"Copy game state to clipboard"}),(0,t.jsx)(a.zx,{onClick:async()=>{let e=JSON.parse(await navigator.clipboard.readText());R(e),O.current.forEach(n=>{n.send({action:"setGame",game:e})})},children:"Import game state from clipboard (DANGEROUS)"}),(0,t.jsxs)(a.kC,{align:"center",gap:"3",children:[(0,t.jsx)(a.xv,{children:"Autosave game state to clipboard"}),(0,t.jsx)(a.rs,{checked:D,onCheckedChange:e=>N(e)})]})]})]})]}),"start"==A.state?(0,t.jsx)(a.zx,{onClick:()=>{let e;let n=(function(e){let n=e.length;for(;0!=n;){let r=Math.floor(Math.random()*n);n--,[e[n],e[r]]=[e[r],e[n]]}}(e=structuredClone(o.filter(e=>"b"!==e))),e),r=structuredClone(A);r.state="playing",r.turn=G;for(let e=0;e<n.length;e++){let t=n[e];r.players[e%r.players.length].cards.push(t)}R(r),O.current.forEach(e=>{e.send({action:"setGame",game:r})})},children:"Start"}):(A.state,null)]}):null]}),(0,t.jsx)(a.xu,{height:"32px"}),(0,t.jsxs)(a.kC,{gap:"6",children:[(0,t.jsxs)(a.kC,{direction:"column",align:"center",gap:"3",style:ex(G),children:[(0,t.jsxs)(a.X6,{size:"5",children:["Your cards: ",T.cards.length]}),(0,t.jsxs)(a.xu,{position:"relative",mb:"24px",children:[(0,t.jsx)(f,{card:"b",style:{width:"200px",opacity:0,marginLeft:2*T.cards.length+"px"}}),T.cards.map((e,n)=>(0,t.jsx)(f,{card:"b",style:{width:"200px",position:"absolute",left:2*n+"px",top:"0px"}},crypto.randomUUID()))]})]}),(0,t.jsx)(a.xu,{children:(0,t.jsx)(a.Z0,{orientation:"vertical",size:"4"})}),(0,t.jsxs)(a.kC,{direction:"column",gap:"3",pb:"3",pr:"3",width:"250px",children:[(0,t.jsx)(a.X6,{size:"5",className:"text-center",children:"Log"}),(0,t.jsx)(a.kC,{direction:"column",height:"246px",overflowY:"scroll",ref:ep,children:A.chat.map(e=>(0,t.jsx)(a.xv,{className:"whitespace-pre-wrap",children:e},crypto.randomUUID()))}),(0,t.jsxs)(a.kC,{gap:"3",children:[(0,t.jsxs)(a.Vq.fC,{children:[(0,t.jsx)(a.Vq.xz,{children:(0,t.jsx)(a.hU,{children:0==Object.entries(ei).reduce((e,n)=>{let[r,t]=n;return e+t},0)?(0,t.jsx)(y.h_8,{}):(0,t.jsx)(y.rgF,{})})}),(0,t.jsxs)(a.Vq.VY,{children:[(0,t.jsx)(a.Vq.Dx,{children:"Charity"}),(0,t.jsx)(a.Vq.dk,{children:"Donate your cards to people in need!"}),(0,t.jsxs)(a.iA.fC,{children:[(0,t.jsx)(a.iA.h4,{children:(0,t.jsxs)(a.iA.X2,{children:[(0,t.jsx)(a.iA.Ni,{children:"Username"}),(0,t.jsx)(a.iA.Ni,{children:"Cards"}),(0,t.jsx)(a.iA.Ni,{children:"Total slaps"}),(0,t.jsx)(a.iA.Ni,{children:"Slap %"}),(0,t.jsx)(a.iA.Ni,{children:"Donate"})]})}),(0,t.jsx)(a.iA.uT,{children:A.players.filter(e=>e.id!=T.id).map(e=>{var n;return(0,t.jsxs)(a.iA.X2,{children:[(0,t.jsx)(a.iA.x0,{children:e.username}),(0,t.jsx)(a.iA.x0,{children:e.cards.length}),(0,t.jsx)(a.iA.x0,{}),(0,t.jsx)(a.iA.x0,{}),(0,t.jsx)(a.iA.x0,{children:(0,t.jsx)(a.nv.Root,{size:"1",value:null!==(n=es[e.id])&&void 0!==n?n:"0",onChange:n=>ec({...es,[e.id]:n.target.value}),onBlur:()=>{let n=parseInt(es[e.id]);if(Number.isNaN(n)||n<0){var r;ec({...es,[e.id]:""+(null!==(r=ei[e.id])&&void 0!==r?r:0)})}else ec({...es,[e.id]:""+n}),el({...ei,[e.id]:n})}})})]},e.id)})})]})]})]}),(0,t.jsx)(a.nv.Root,{placeholder:"Message...",value:S,onChange:e=>E(e.target.value),onKeyDown:e=>{"Enter"==e.key&&(Z(),E(""),e.target.blur())}}),(0,t.jsx)(a.hU,{onClick:Z,children:(0,t.jsx)(y.kcA,{})})]})]}),(0,t.jsx)(a.xu,{children:(0,t.jsx)(a.Z0,{orientation:"vertical",size:"4"})}),(0,t.jsxs)(a.kC,{direction:"column",align:"center",gap:"3",children:[(0,t.jsxs)(a.X6,{size:"5",children:["Cards on stack: ",A.stack.length]}),(0,t.jsxs)(a.xu,{position:"relative",mb:"24px",children:[(0,t.jsx)(f,{card:"b",style:{width:"200px",opacity:0,marginLeft:16*A.stack.length+"px"}}),A.stack.map((e,n)=>(0,t.jsx)(f,{card:e,style:{width:"200px",position:"absolute",left:16*n+"px",top:"0px"}},crypto.randomUUID()))]})]}),(0,t.jsx)(a.xu,{children:(0,t.jsx)(a.Z0,{orientation:"vertical",size:"4"})})]}),(0,t.jsx)(a.Z0,{size:"4"}),(0,t.jsx)(a.kC,{mt:"24px",gap:"3",children:A.players.filter(e=>e.id!=T.id).map(e=>(0,t.jsxs)(a.kC,{direction:"column",align:"center",gap:"3",style:ex(A.players.findIndex(n=>n.id==e.id)),children:[(0,t.jsxs)(a.X6,{size:"3",children:[e.username+"'s"," cards: ",e.cards.length]}),(0,t.jsx)(a.xu,{position:"relative",mb:"24px",children:(0,t.jsx)(f,{card:"b",style:{width:"100px",opacity:0,marginLeft:1*e.cards.length+"px"}})})]},crypto.randomUUID()))})]}):null})}}},e=>{var n=n=>e(e.s=n);e.O(0,[507,189,194,947,170,744],()=>n(6655)),_N_E=e.O()}]);